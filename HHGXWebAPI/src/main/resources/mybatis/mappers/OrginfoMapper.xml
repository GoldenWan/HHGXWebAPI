<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hhgx.soft.mappers.OrginfoMapper">

	<select id="getOnlineOrg" resultType="onlineOrg">
		SELECT
		orgcode,
		orgname,
		vAddress,
		OrganType,
		vNamelegalperson,
		otherthings,
		YnImportant,
		SuperiorOrg,
		cZip,
		vTel,
		fax,
		`E-Mail` eMail,
		howmanypeople,
		souyouzhi,
		SetupDate,
		realtymoney,
		ipersonnum,
		fAreanum,
		fBuildingarea,
		GasType,
		howmanyfireman,
		howmanyexit,
		howmanystair,
		howmanylane,
		howmanyelevator,
		lanelocation,
		vfireroomtel,
		escapefloor,
		escapebuildingarea,
		escapelocation,
		neareast,
		nearsouth,
		nearwest,
		nearnorth,
		AutoFireFacility,
		bFlatpic,
		dRecordDate,
		managegrade,
		NetworkStatus,
		NetworkTime,
		ApproveState,
		ApproveTime,
		ApproveMan,
		AreaId,
		ManagerOrgID
		FROM
		onlineorg
		WHERE
		OrgID = #{orgID}
	</select>

	<update id="updateOnlineOrg">
		UPDATE onlineorg
		SET orgcode = #{orgcode} ,
		orgname =
		#{orgname} ,
		vAddress = #{vAddress} ,
		OrganType = #{organType} ,
		vNamelegalperson = #{vNamelegalperson} ,
		otherthings = #{otherthings} ,
		YnImportant = #{ynImportant} ,
		SuperiorOrg = #{superiorOrg} ,
		cZip =
		#{cZip} ,
		vTel = #{vTel} ,
		fax = #{fax} ,
		`E-Mail` = #{eMail} ,
		howmanypeople = #{howmanypeople} ,
		souyouzhi = #{souyouzhi} ,
		SetupDate
		= #{setupDate} ,
		realtymoney = #{realtymoney} ,
		ipersonnum =
		#{ipersonnum} ,
		fAreanum = #{fAreanum} ,
		fBuildingarea =
		#{fBuildingarea} ,
		GasType = #{gasType} ,
		howmanyfireman =
		#{howmanyfireman} ,
		howmanyexit = #{howmanyexit} ,
		howmanystair =
		#{howmanystair} ,
		howmanylane = #{howmanylane} ,
		howmanyelevator =
		#{howmanyelevator} ,
		lanelocation = #{lanelocation} ,
		vfireroomtel =
		#{vfireroomtel} ,
		escapefloor = #{escapefloor} ,
		escapebuildingarea =
		#{escapebuildingarea} ,
		escapelocation = #{escapelocation} ,
		neareast =
		#{neareast} ,
		nearsouth = #{nearsouth} ,
		nearwest = #{nearwest} ,
		nearnorth = #{nearnorth} ,
		AutoFireFacility = #{autoFireFacility} ,
		bFlatpic = #{bFlatpic} ,
		dRecordDate = #{dRecordDate} ,
		managegrade =
		#{managegrade} ,
		NetworkStatus = #{networkStatus},
		NetworkTime =
		#{networkTime},
		ApproveState = #{approveState},
		ApproveTime =
		#{approveTime},
		ApproveMan = #{approveMan},
		AreaId = #{areaId},
		ManagerOrgID = #{managerOrgID}
		WHERE
		OrgID = #{orgID}
	</update>
	<select id="getBusinessLicence" resultType="businessLicence">
		SELECT
		LicenceCode,
		ConpanyName,
		CompanyType,
		CompanyAddress,
		CompanyRegister,
		RegistMoney,
		BuildTime,
		BusinessEndTime,
		BusinessScope,
		AuditingDepartment,
		RegistTime,
		PictureUrl,
		orgid
		FROM
		businesslicence
		WHERE
		orgid = #{orgid}
	</select>

	<select id="getFireSystemList" resultType="fireSystem">
		SELECT
		s.siteid,
		s.sitename,
		o.tiSysType,
		f.vSysdesc
		FROM
		site s
		INNER JOIN onlinefiresystem
		o ON s.siteid = o.siteid
		INNER JOIN firesystype f ON o.tiSysType =
		f.tiSysType
		WHERE
		s.orgid = #{orgid}
	</select>
	<select id="getSiteList" resultType="site">
		SELECT
			siteid,
			sitename,
			buildingaddress,
			useproperty,
			DSCS,
			JZGD,
			DSJZMJ,
			NHDJ,
			JGLX,
			DXCS,
			DXJZMJ,
			SDQK,
			ZYCCW,
			RLRS,
			QLJZ,
			east,
			west,
			south,
			north,
			xx,
			yy,
			sitetypename,
			holdthings,
			holdthingsnum,
			annalTime,
			fLongitude,
			fLatitude,
			orgid
		FROM
			site s
		WHERE
		s.orgid = #{orgid}
	</select>
	<select id="getSiteName" resultType="site">
	SELECT
		siteid,
		sitename
	FROM
		site
	WHERE
		orgid = #{orgid}
	</select>

	<select id="getFireSystemListCount" resultType="int">
		SELECT
		count(*)
		FROM
		site s
		INNER JOIN onlinefiresystem o ON s.siteid = o.siteid
		INNER
		JOIN firesystype f ON o.tiSysType = f.tiSysType
		WHERE
		s.orgid = #{orgid}

	</select>

	<select id="getFireSystemListByPage" resultType="fireSystem">
		SELECT
		s.siteid,
		s.sitename,
		o.tiSysType,
		f.vSysdesc
		FROM
		site s
		INNER JOIN onlinefiresystem
		o ON s.siteid = o.siteid
		INNER JOIN firesystype f ON o.tiSysType =
		f.tiSysType
		WHERE
		s.orgid = #{orgid}
		limit
		#{startPos},#{pageSize}
	</select>

	<select id="briefsiteList" resultType="site">
		SELECT
		s.siteid,
		s.sitename
		FROM
		site s
		WHERE
		s.orgid = #{orgid}
	</select>
	<select id="getMapPoint" resultType="site">
	SELECT
		s.fLongitude,
		s.fLatitude
	FROM
		site s
	WHERE
		s.orgid = #{orgid}
	</select>
	<delete id="deleteorgSys">
		DELETE
		FROM
		onlinefiresystem
		WHERE
		siteid = #{siteid} and
		tiSysType=#{tiSysType}
	</delete>
	<delete id="deleteGatewaySysInfo">
		DELETE
		FROM
		gatewaysysteminfo
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</delete>

	<delete id="deleteGateway">
		DELETE
		FROM
		gateway
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</delete>
	<select id="gePatrolRecordByOrgCount" resultType="int">
		SELECT
		count(*)
		FROM
		gateway g
		INNER JOIN v_Gateway v on g.Gatewayaddress =
		v.Gatewayaddress
		WHERE
		v.orgid = #{orgid}

	</select>

	<select id="selectGateway" resultMap="gatewayMap">
		SELECT
		g.Gatewayaddress
		Gatewayaddress,
		Manufacturer,
		Model,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo,
		ynonline,
		onlinetime
		FROM
		gateway g
		INNER JOIN v_Gateway v ON g.Gatewayaddress = v.Gatewayaddress
		WHERE
		v.orgid = #{orgid}
		limit
		#{startPos},#{pageSize}
	</select>
	<resultMap type="gateway" id="gatewayMap">
		<id column="siteid" property="siteid" />
		<result column="sitename" property="sitename" />
		<result column="tiSysType" property="tiSysType" />
		<result column="vSysdesc" property="vSysdesc" />
		<result column="Sysaddress" property="Sysaddress" />
		<collection property="gatewaySystemInfoList" column="Gatewayaddress"
			select="selectVgateway" />
	</resultMap>

	<select id="selectVgateway" resultType="gatewaySystemInfo">
	SELECT
		siteid,
		sitename,
		tiSysType,
		vSysdesc,
		Sysaddress
	FROM
		v_Gateway
	WHERE
		gatewayaddress =
		#{gatewayaddress}
	</select>
	<insert id="addSite">
	INSERT INTO site (
		siteid,
		sitename,
		buildingaddress,
		useproperty,
		DSCS,
		JZGD,
		DSJZMJ,
		NHDJ,
		JGLX,
		DXCS,
		DXJZMJ,
		SDQK,
		ZYCCW,
		RLRS,
		QLJZ,
		east,
		west,
		south,
		north,
		xx,
		yy,
		sitetypename,
		holdthings,
		holdthingsnum,
		annalTime,
		fLongitude,
		fLatitude,
		orgid
	)
VALUES
	(   #{siteid},
		#{sitename},
		#{buildingaddress},
		#{useproperty},
		#{dSCS},
		#{jZGD},
		#{dSJZMJ},
		#{nHDJ},
		#{jGLX},
		#{dXCS},
		#{dXJZMJ},
		#{sDQK},
		#{zYCCW},
		#{rLRS},
		#{qLJZ},
		#{east},
		#{west},
		#{south},
		#{north},
		#{xx},
		#{yy},
		#{sitetypename},
		#{holdthings},
		#{holdthingsnum},
		#{annalTime},
		#{fLongitude},
		#{fLatitude},
		#{orgid}
	)
	</insert>
	<insert id="addGatewaySysInfo">
		INSERT INTO gatewaysysteminfo (
		Sysaddress,
		Gatewayaddress,
		tiSysType,
		siteid
		)
		VALUES
		(
		#{sysaddress},
		#{gatewayaddress},
		#{tiSysType},
		#{siteid}
		)
	</insert>
	<insert id="addGateway">
		INSERT INTO gateway (
		Gatewayaddress,
		Manufacturer,
		Model,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo
		)
		VALUES
		(
		#{gatewayaddress},
		#{manufacturer},
		#{model},
		#{productdate},
		#{setupdate},
		#{controlorManufacture},
		#{controlorMode},
		#{memo}
		)
	</insert>

	<insert id="updateGateway">
		INSERT INTO gateway (
		Manufacturer,
		Model,
		Gatewayaddress,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo
		)
		VALUES
		(
		#{manufacturer} ,
		#{model} ,
		#{gatewayaddress},
		#{productdate} ,
		#{setupdate} ,
		#{controlorManufacture} ,
		#{controlorMode} ,
		#{memo}
		)
	</insert>

	<select id="findGatewayaddressExist" resultType="int">
		SELECT
		count(*)
		FROM
		gateway
		WHERE
		Gatewayaddress = #{gatewayaddress}
	</select>

	<update id="updateGatewaySame">
		UPDATE gateway
		SET Manufacturer = #{manufacturer},
		Model = #{model} ,
		productdate = #{productdate} ,
		setupdate =
		#{setupdate} ,
		ControlorManufacture = #{controlorManufacture} ,
		ControlorMode = #{controlorMode} ,
		memo = #{memo}
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</update>
	<insert id="updateGatewaySysInfo">
		INSERT INTO
		gatewaysysteminfo
		(siteid,tiSysType,Gatewayaddress,Sysaddress)
		values
		(#{siteid},#{tiSysType},#{gatewayaddress}, #{sysaddress} )

	</insert>

	<select id="getflatpicList" resultType="flatpic">
		SELECT
		s.siteid siteid,
		sitename sitename,
		cFlatPic cFlatPic,
		floornum floornum,
		dRecordSet
		dRecordSet,
		imFlatPic imFlatPic
		FROM
		site s,
		flatpic f
		WHERE
		s.siteid =
		#{siteid}
		AND orgid = #{orgid}
	</select>

	<delete id="deleteflatPic">
		DELETE
		FROM
		flatpic
		WHERE
		cFlatPic = #{cFlatPic}
	</delete>
	<delete id="deleteDevices">
		DELETE
		FROM
		devices
		WHERE
		deviceaddress =
		#{deviceaddress} and
		Sysaddress = #{sysaddress} and
		Gatewayaddress =
		#{gatewayaddress}
	</delete>
	<select id="findMaxDeviceNo" resultType="string">
		SELECT
		max(DeviceNo)
		FROM
		devices
		WHERE
		cFlatPic = #{cFlatPic}
	</select>

	<insert id="addDevices">
		INSERT INTO devices (
		DeviceNo,
		deviceaddress,
		Road,
		Address,
		sysaddress,
		gatewayaddress,
		vdesc,
		fPositionX,
		fPositionY,
		location,
		Manufacture,
		Model,
		ProductDate,
		expdate,
		AddTime,
		memo,
		cFlatPic,
		iDeviceType
		)
		VALUES
		(
		#{deviceNo} ,
		#{deviceaddress} ,
		#{road} ,
		#{address}
		,
		#{sysaddress} ,
		#{gatewayaddress} ,
		#{vdesc} ,
		#{fPositionX} ,
		#{fPositionY} ,
		#{location} ,
		#{manufacture} ,
		#{model} ,
		#{productDate} ,
		#{expdate} ,
		#{addTime} ,
		#{memo} ,
		#{cFlatPic} ,
		#{iDeviceType}
		)
	</insert>
	<update id="updateDevices">
		UPDATE devices
		SET DeviceNo = #{deviceNo} ,
		Road =
		#{road} ,
		Address = #{address} ,
		vdesc = #{vdesc} ,
		fPositionX =
		#{fPositionX} ,
		fPositionY = #{fPositionY} ,
		location = #{location} ,
		Manufacture = #{manufacture} ,
		Model = #{model} ,
		ProductDate =
		#{productDate} ,
		expdate = #{expdate} ,
		AddTime = #{addTime} ,
		memo =
		#{memo } ,
		cFlatPic = #{cFlatPic} ,
		iDeviceType = #{iDeviceType}
		WHERE
		deviceaddress = #{deviceaddress} and
		Sysaddress = #{sysaddress} and
		Gatewayaddress = #{gatewayaddress}
	</update>
	<delete id="deleteDevicesBycflatPic">
		DELETE
		FROM
		devices
		WHERE
		cFlatPic = #{cFlatPic}
	</delete>
	<select id="selectDevicesListCount" resultType="int">
		SELECT
		count(*)
		FROM
		devices
		where
		cFlatPic = #{cFlatPic}
		<if test="iDeviceType!='0'.toString()">
			AND
			iDeviceType = #{iDeviceType}
		</if>
		<if test="deviceaddress!='0'.toString() ">
			AND
			deviceaddress = #{deviceaddress}
		</if>
	</select>
	<select id="selectDevicesLists" resultType="deviceList">
		SELECT
		c.deviceaddress deviceaddress,
		c.sysaddress sysaddress,
		c.gatewayaddress gatewayaddress,
		c.fPositionX fPositionX,
		c.fPositionY fPositionY,
		c.location location,
		c.DeviceNo deviceNo,
		c.iDeviceType iDeviceType,
		f.imFlatPic imFlatPic,
		d.DeviceTypeName deviceTypeName
		FROM
		devices c
		INNER JOIN flatpic f ON c.cFlatPic = f.cFlatPic
		INNER JOIN devicetype d ON c.iDeviceType = d.iDeviceType
		WHERE
		c.cFlatPic = #{cFlatPic}
		<if test="iDeviceType!='0'.toString()">
			AND
			c.iDeviceType = #{iDeviceType}
		</if>
		<if test="deviceaddress!='0'.toString() ">
			AND
			c.deviceaddress = #{deviceaddress}
		</if>
	</select>
	<select id="selectDeviceDetail" resultType="devices">
		SELECT
		deviceaddress,
		sysaddress,
		gatewayaddress,
		vdesc,
		fPositionX,
		fPositionY,
		location,
		Manufacture manufacture,
		Model model,
		ProductDate productDate,
		expdate expdate,
		AddTime addTime,
		memo memo,
		DeviceNo deviceNo,
		cFlatPic cFlatPic,
		c.iDeviceType iDeviceType,
		StateValue stateValue,
		StateTime stateTime,
		d.DeviceTypeName deviceTypeName
		FROM
		devices c
		INNER JOIN devicetype d ON c.iDeviceType = d.iDeviceType
		WHERE
		c.Gatewayaddress = #{gatewayaddress}
		AND c.Sysaddress = #{sysaddress}
		AND c.deviceaddress = #{deviceaddress}

	</select>
	<!-- <update id="updateMarkPoint">
	UPDATE devices
	SET 
	fPositionX = #{fPositionX},
	 fPositionY = #{fPositionY}
	WHERE
		deviceaddress = #{deviceaddress}
	AND sysaddress = #{sysaddress}
	AND gatewayaddress = #{gatewayaddress}
	</update>
	<select id="returnMarkPoint" resultType="devices">
	SELECT
		c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress,
		c.DeviceNo,
		d.iDeviceType iDeviceType,
		d.DeviceTypeName
	FROM
		devices c,
		devicetype d
	WHERE
		c.cFlatPic = #{cFlatPic}
	AND c.DeviceNo = #{deviceNo}
	
	</select>
	<select id="findMarkPoint" resultType="devices">
	SELECT
		c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress,
		c.DeviceNo,
		d.iDeviceType iDeviceType,
		d.DeviceTypeName
	FROM
		devices c,
		devicetype d
	WHERE
		deviceaddress = #{deviceaddress}
	AND sysaddress = #{sysaddress}
	AND gatewayaddress = #{gatewayaddress}
	
	
	</select>
	<select id="getFirstDevice" resultType="devices">
	SELECT
		c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress,
		c.DeviceNo,
		c.iDeviceType,
		d.DeviceTypeName
	FROM
		devices c,
		devicetype d
	WHERE
		c.cFlatPic = #{cFlatPic}
	</select>
	<select id="getOneDevice" resultType="devices">
	SELECT
		c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress,
		c.DeviceNo
	FROM
		devices c
	WHERE
		c.cFlatPic = #{cFlatPic}
	AND c.DeviceNo = #{deviceNo}
	</select> -->
	
	

</mapper>