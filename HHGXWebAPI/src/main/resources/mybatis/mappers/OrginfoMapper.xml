<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hhgx.soft.mappers.OrginfoMapper">

	<update id="updateMarkPoint">
	 UPDATE 
	 devices 
		<trim prefix="set" suffixOverrides=",">
		<if test="fPositionX!=null and fPositionX!=''">
	    fPositionX = #{fPositionX},</if>
	    <if test="fPositionY!=null and fPositionY!=''">
		fPositionY = #{fPositionY}, </if>
		</trim>
	WHERE 
		deviceaddress = #{deviceaddress} 
		AND
		Sysaddress= #{sysaddress} 
		AND 
		Gatewayaddress = #{gatewayaddress}
	</update>
	<select id="getDeviceNosByFlatpic" resultType="int"> 
	SELECT
		DeviceNo
	FROM
		devices
	WHERE
		cFlatPic = #{cFlatPic}
	ORDER BY
		DeviceNo ASC
	</select>
	<select id="returnMarkPoint" resultType="devices"> 
	SELECT
		c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress,
		c.DeviceNo,
		c.iDeviceType,
		d.DeviceTypeName
	FROM
		devices c,
		devicetype d
	WHERE
		c.cFlatPic = #{cFlatPic} 
	AND c.DeviceNo = #{deviceNo}
	</select>

	<select id="getFirstDevice" resultType="devices"> SELECT c.deviceaddress,
		c.sysaddress, c.gatewayaddress, c.DeviceNo, c.iDeviceType,
		d.DeviceTypeName
		FROM devices c, devicetype d WHERE c.cFlatPic = #{cFlatPic}
	</select>
	<select id="getOneDevice" resultType="devices"> 
	SELECT c.deviceaddress,
		c.sysaddress,
		c.gatewayaddress, c.DeviceNo 
		FROM devices c 
		WHERE c.cFlatPic = #{cFlatPic}
		AND c.DeviceNo = #{deviceNo}
	</select>

	<select id="getOnlineOrg" resultType="map">
	SELECT
		orgid,
		orgcode,
		orgname,
		vAddress,
		OrganType,
		vNamelegalperson,
		otherthings,
		YnImportant,
		SuperiorOrg,
		cZip,
		vTel,
		fax,
		`E-Mail` E_Mail,
		howmanypeople,
		souyouzhi,
		DATE_FORMAT(SetupDate, '%Y/%m/%d') SetupDate,
		CAST(realtymoney AS CHAR) realtymoney,
		CAST(ipersonnum AS CHAR) ipersonnum,
		CAST(fAreanum AS CHAR) fAreanum,
		CAST(fBuildingarea AS CHAR) fBuildingarea,
		GasType,
		CAST(howmanyfireman AS CHAR) howmanyfireman,
		CAST(howmanyexit AS CHAR) howmanyexit,
		CAST(howmanystair AS CHAR) howmanystair,
		CAST(howmanylane AS CHAR) howmanylane,
		CAST(howmanyelevator AS CHAR) howmanyelevator,
		lanelocation,
		vfireroomtel,
		CAST(escapefloor AS CHAR) escapefloor,
		CAST(escapebuildingarea AS CHAR) escapebuildingarea,
		escapelocation,
		neareast,
		nearsouth,
		nearwest,
		nearnorth,
		AutoFireFacility,
		CAST(fLongitude AS CHAR) fLongitude,
		CAST(fLatitude AS CHAR) fLatitude,
		managegrade,
		NetworkStatus,
		DATE_FORMAT(
			dRecordDate,
			'%Y/%m/%d %h:%m:%s'
		) dRecordDate,
		DATE_FORMAT(
			NetworkTime,
			'%Y/%m/%d %h:%m:%s'
		) NetworkTime,
		ApproveState,
		ApproveMan,
		AreaId,
		ManagerOrgID,
		bFlatpic,
		DATE_FORMAT(
			ApproveTime,
			'%Y/%m/%d %h:%m:%s'
		) ApproveTime
	FROM
	onlineorg
	WHERE
		OrgID = #{orgID}
	</select>

	<update id="updateOnlineOrg">
		UPDATE onlineorg
		<trim prefix="set" suffixOverrides=",">
			<if test="orgcode!=null and orgcode!=''">orgcode = #{orgcode} ,</if>
			<if test="orgname!=null and orgname!=''">orgname =#{orgname} , </if>
			<if test="souyouzhi!=null and souyouzhi!=''">souyouzhi = #{souyouzhi} , </if>
			<if test="organType!=null and organType!=''">OrganType = #{organType} , </if>
			<if test="vNamelegalperson!=null and vNamelegalperson!=''">vNamelegalperson = #{vNamelegalperson} , </if>
			<if test="otherthings!=null and otherthings!=''">otherthings = #{otherthings} , </if>
			<if test="ynImportant!=null and ynImportant!=''">YnImportant = #{ynImportant} , </if>
			<if test="superiorOrg!=null and superiorOrg!=''">SuperiorOrg = #{superiorOrg} , </if>
			<if test="cZip !=null and cZip !=''">cZip =#{cZip} , </if>
			<if test="vTel !=null and vTel!=''">vTel = #{vTel} , </if>
			<if test="fax !=null and fax !=''">fax =#{fax} , </if>
			<if test="eMail !=null and eMail !=''">`E-Mail` = #{eMail} , </if>
			<if test="howmanypeople !=null and howmanypeople !=''">howmanypeople = #{howmanypeople} , </if>
			<if test="setupDate !=null and setupDate !=''">SetupDate= #{setupDate} , </if>
			<if test="realtymoney !=null and realtymoney !=''">realtymoney = #{realtymoney} , </if>
			<if test="ipersonnum !=null and ipersonnum !=''">ipersonnum = #{ipersonnum} , </if>
			<if test="fAreanum !=null and fAreanum !=''">fAreanum =#{fAreanum}, </if>
			<if test="fBuildingarea !=null and fBuildingarea !=''">fBuildingarea = #{fBuildingarea} , </if>
			<if test="gasType !=null and gasType !=''">GasType = #{gasType} , </if>
			<if test="howmanyfireman !=null and howmanyfireman !=''">howmanyfireman = #{howmanyfireman} , </if>
			<if test="howmanyexit !=null and howmanyexit !=''">howmanyexit = #{howmanyexit} , </if>
			<if test="howmanystair !=null and howmanystair !=''">howmanystair = #{howmanystair} , </if>
			<if test="howmanylane !=null and howmanylane !=''">howmanylane = #{howmanylane} , </if>
			<if test="howmanyelevator !=null and howmanyelevator !=''">howmanyelevator = #{howmanyelevator} , </if>
			<if test="lanelocation !=null and lanelocation !=''">lanelocation = #{lanelocation} , </if>
			<if test="vfireroomtel !=null and vfireroomtel !=''">vfireroomtel = #{vfireroomtel} , </if>
			<if test="escapefloor !=null and escapefloor !=''">escapefloor = #{escapefloor} , </if>
			<if test="escapebuildingarea !=null and escapebuildingarea !=''">escapebuildingarea = #{escapebuildingarea} , </if>
			<if test="neareast !=null and neareast !=''">neareast = #{neareast} , </if>
			<if test="nearsouth !=null and nearsouth !=''">nearsouth = #{nearsouth} , </if>
			<if test="nearwest !=null and nearwest !=''">nearwest = #{nearwest} , </if>
			<if test="nearnorth !=null and nearnorth !=''">nearnorth =#{nearnorth} , </if>
			<if test="autoFireFacility !=null and autoFireFacility !=''">AutoFireFacility = #{autoFireFacility} , </if>
			<if test="dRecordDate !=null and dRecordDate !=''">dRecordDate =#{dRecordDate} , </if>
			<if test="managegrade !=null and managegrade !=''">managegrade = #{managegrade} , </if>
			<if test="networkStatus !=null and networkStatus !=''">NetworkStatus =#{networkStatus}, </if>
			<if test="networkTime!=null and networkTime!=''">NetworkTime = #{networkTime}, </if>
			<if test="approveState!=null and approveState!=''"> ApproveState =#{approveState}, </if>
			<if test="managerOrgID!=null and managerOrgID!='' and managerOrgID!='undefined'">ManagerOrgID = #{managerOrgID}, </if>
			<if test="vAddress!=null and vAddress!='' and vAddress!='undefined'">vAddress = #{vAddress}, </if>
		</trim>
		WHERE
		OrgID = #{orgID}
	</update>
	<update id="setMapPoint">
		UPDATE onlineorg
		<trim prefix="set" suffixOverrides=",">
			<if test="fLatitude!=null and fLatitude!=''">
				fLatitude = #{fLatitude} ,</if>
			<if test="fLongitude!=null and fLongitude!=''">
				fLongitude = #{fLongitude}
			</if>
		</trim>
		WHERE
		orgid = #{orgid}
	</update>
	<select id="getBusinessLicence" resultType="businessLicence">
		SELECT
		LicenceCode,
		ConpanyName,
		CompanyType,
		CompanyAddress,
		CompanyRegister,
		RegistMoney,
		BuildTime,
		BusinessEndTime,
		BusinessScope,
		AuditingDepartment,
		RegistTime,
		PictureUrl,
		orgid
		FROM
		businesslicence
		WHERE
		orgid = #{orgid}
		order by RegistTime
	</select>

	<select id="findDevicesTypeByName" resultType="string">
		SELECT
		iDeviceType
		FROM
		devicetype
		WHERE
		DeviceTypeName = #{deviceTypeName}
	</select>
	<select id="orgSiteSys" resultMap="siteSysMap">
		SELECT
		s.siteid,
		s.sitename,
		o.tiSysType
		FROM
		site s
		INNER JOIN onlinefiresystem o ON s.siteid =o.siteid
		WHERE
		orgid = #{orgid}
	</select>
	<resultMap type="site" id="siteSysMap">
		<id column="siteid" property="siteid" />
		<result column="sitename" property="sitename" />
		<collection property="firesystypes" column="tiSysType"
			select="findSystypeById" />
	</resultMap>

	<select id="findSystypeById" resultType="firesystype">
		SELECT
		tiSysType,
		vSysdesc
		FROM
		firesystype
		WHERE
		tiSysType =#{tiSysType}
	</select>

	<select id="getFireSystemList" resultType="fireSystem">
		SELECT
		s.siteid,
		s.sitename,
		o.tiSysType,
		f.vSysdesc
		FROM
		site s
		INNER JOIN onlinefiresystem
		o ON s.siteid = o.siteid
		INNER JOIN firesystype f ON o.tiSysType =
		f.tiSysType
		WHERE
		s.orgid = #{orgid}
	</select>
	<select id="getSiteList" resultType="site">
		SELECT
		siteid,
		sitename,
		buildingaddress,
		useproperty,
		DSCS,
		JZGD,
		DSJZMJ,
		NHDJ,
		JGLX,
		DXCS,
		DXJZMJ,
		SDQK,
		ZYCCW,
		RLRS,
		QLJZ,
		east,
		west,
		south,
		north,
		xx,
		yy,
		sitetypename,
		holdthings,
		holdthingsnum,
		annalTime,
		fLongitude,
		fLatitude,
		orgid
		FROM
		site
		s
		WHERE
		s.orgid = #{orgid}
		limit
		#{startPos},#{pageSize}
	</select>
	<select id="getSite" resultType="site">
		SELECT
		sitename,
		buildingaddress,
		useproperty,
		DSCS,
		JZGD,
		DSJZMJ,
		NHDJ,
		JGLX,
		DXCS,
		DXJZMJ,
		SDQK,
		ZYCCW,
		RLRS,
		QLJZ,
		east,
		west,
		south,
		north,
		xx,
		yy,
		sitetypename,
		holdthings,
		holdthingsnum,
		annalTime,
		fLongitude,
		fLatitude,
		orgid
		FROM
		site s
		WHERE
		s.siteid = #{siteid}
	</select>
	<select id="getSiteNeedAddress" resultMap="siteTypeMap">
		SELECT
			DISTINCT  Gatewayaddress
		FROM
		gatewaysysteminfo
		WHERE
		siteid = #{siteid}
	</select>
	<resultMap type="gatewaySystemInfo" id="siteTypeMap">
		<result column="Gatewayaddress" property="gatewayaddress" />
		<collection property="firesystypes" column="Gatewayaddress"
			select="selectSystemInfo" />
	</resultMap>

	<select id="selectSystemInfo" resultType="firesystype">
		SELECT
		g.tiSysType,
		vSysdesc,
		Sysaddress
		FROM
		gatewaysysteminfo g
		INNER JOIN firesystype f ON
		g.tiSysType = f.tiSysType
		WHERE
		g.Gatewayaddress
		=
		#{gatewayaddress}
	</select>



	<select id="getSiteName" resultType="site">
		SELECT
		siteid,
		sitename
		FROM
		site
		WHERE
		orgid = #{orgid}
	</select>
	<select id="getSiteTotalCount" resultType="int">
		SELECT
		count(*)
		FROM
		site
		WHERE
		orgid = #{orgid}
	</select>
	<select id="dataMonitorCount" resultType="int">
		SELECT
		count(*)
		FROM
		onlinefiresystem o
		inner JOIN site s ON o.siteid =
		s.siteid
		inner JOIN firesystype f ON
		o.tiSysType = f.tiSysType
		inner JOIN
		devicetype t ON f.tiSysType =
		t.tiSysType
		inner JOIN devices d ON
		t.iDeviceType = d.iDeviceType
		WHERE
		o.siteid=#{siteid}
		<if test="tiSysType!=null and tiSysType!=''">
			and
			o.tiSysType=#{tiSysType}
		</if>
	</select>
	
	<delete id="deleteSite">
		DELETE
		FROM
		site
		WHERE
		siteid = #{siteid}
	</delete>
	<delete id="deleteAppearance">
		DELETE
		FROM
		appearancepic
		WHERE
		iphotoID = #{iphotoID}
	</delete>

	<select id="getFireSystemListCount" resultType="int">
		SELECT
		count(*)
		FROM
		site s
		INNER JOIN onlinefiresystem o ON s.siteid = o.siteid
		INNER
		JOIN
		firesystype f ON o.tiSysType = f.tiSysType
		WHERE
		s.orgid = #{orgid}

	</select>

	<select id="getFireSystemListByPage" resultType="map">
		SELECT
		o.tiSysType,
		f.vSysdesc,
		o.siteid,
		s.sitename,
		o.states,
		o.YnOnline,
		o.Remarks,
		o.SysFlatpic
		FROM
		site s
		INNER JOIN onlinefiresystem o ON
		s.siteid = o.siteid
		INNER JOIN firesystype f ON o.tiSysType =
		f.tiSysType
		WHERE
		s.orgid =
		#{orgid}
		limit
		#{startPos},#{pageSize}
	</select>
	<select id="getOnlineFireSystem" resultType="map">
		SELECT
		o.tiSysType,
		f.vSysdesc,
		s.siteid,
		s.sitename,
		o.states,
		o.YnOnline,
		o.Remarks,
		o.SysFlatpic
		FROM
		site s
		INNER JOIN onlinefiresystem o ON s.siteid =
		o.siteid
		INNER JOIN firesystype f ON o.tiSysType = f.tiSysType
		WHERE
		o.siteid =
		#{siteid}
		and
		o.tisystype=#{tisystype}
	</select>
	<select id="dataMonitor" resultType="map">
		SELECT
		t.iDeviceType,
		t.DeviceTypeName,
		f.tiSysType,
		f.vSysdesc,
		o.siteid,
		s.sitename,
		d.deviceaddress,
		d.Gatewayaddress,
		d.Sysaddress,
		d.location,
		DATE_FORMAT(d.dRecorddate, '%Y/%m/%d') dRecorddate,
		d.dRecorddate,
		d.StateValue
		FROM
		onlinefiresystem o
		inner JOIN site s ON
		o.siteid = s.siteid
		inner JOIN firesystype f ON
		o.tiSysType =
		f.tiSysType
		inner JOIN devicetype t ON f.tiSysType =
		t.tiSysType
		inner
		JOIN devices d ON t.iDeviceType = d.iDeviceType
		where
		o.siteid=#{siteid}
		<if test="tiSysType!=null and tiSysType!=''">
			and
			o.tiSysType=#{tiSysType}
		</if>
		limit
		#{startPos},#{pageSize}
	</select>

	<select id="briefsiteList" resultType="site">
		SELECT
		s.siteid,
		s.sitename
		FROM
		site s
		WHERE
		s.orgid = #{orgid}
	</select>
	<select id="getManagerOrgList" resultType="map">
	SELECT
		ManagerOrgID,
		ManagerOrgName
	FROM
		managerorg
	</select>
	<select id="getOrgListByOrgNameCount" resultType="int">
	SELECT
		count(*)
	FROM
		onlineorg o INNER JOIN area a on o.AreaId = a.AreaId
	    <if test="orgname !=null and orgname !=''">
		WHERE
		orgname = #{orgname}
		</if>
	</select>
	<select id="getOrgListByOrgName" resultType="map">
	SELECT
	orgid,
	orgcode,
	orgname,
	vAddress,
	OrganType,
	vNamelegalperson,
	otherthings,
	YnImportant,
	SuperiorOrg,
	cZip,
	vTel,
	fax,
	`E-mail` email,
	howmanypeople,
	souyouzhi,
	DATE_FORMAT(SetupDate, '%Y/%m/%d') SetupDate,
	realtymoney,
	ipersonnum,
	fAreanum,
	fBuildingarea,
	GasType,
	howmanyfireman,
	howmanyexit,
	howmanystair,
	howmanylane,
	howmanyelevator,
	lanelocation,
	vfireroomtel,
	escapefloor,
	escapebuildingarea,
	escapelocation,
	neareast,
	nearsouth,
	nearwest,
	nearnorth,
	AutoFireFacility,
	fLongitude,
	fLatitude,
	DATE_FORMAT(dRecordDate, '%Y/%m/%d') dRecordDate,
	managegrade,
	NetworkStatus,
	NetworkTime,
	ApproveState,
	DATE_FORMAT(
		ApproveTime,
		'%Y/%m/%d %h:%s:%m'
	) ApproveTime,
	o.AreaId,
	AreaName,
	ManagerOrgID,
	bFlatpic,
	ApproveIdea
FROM
	onlineorg o
INNER JOIN area a ON o.AreaId = a.AreaId
	<if test="orgname !=null and orgname !=''">
		WHERE
	orgname = #{orgname}
	</if>
	</select>
	
	<select id="getMapPoint" resultType="onlineOrg">
		SELECT
		fLongitude,
		fLatitude
		FROM
		onlineorg
		WHERE
		orgid = #{orgid}
	</select>
	<delete id="deleteorgSys">
		DELETE
		FROM
		onlinefiresystem
		WHERE
		siteid = #{siteid} and
		tiSysType=#{tiSysType}
	</delete>
	<delete id="deleteGatewaySysInfo">
		DELETE
		FROM
		gatewaysysteminfo
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</delete>

	<delete id="deleteGateway">
		DELETE
		FROM
		gateway
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</delete>
	<select id="findGatewaySysInfoByType" resultType="map">
		SELECT
		Sysaddress,
		Gatewayaddress
		FROM
		gatewaysysteminfo
		WHERE
		tiSysType
		=#{tiSysType}
	</select>
	<select id="findGatewaySysInfoByAddr" resultType="map">
		SELECT
		Sysaddress,
		Gatewayaddress
		FROM
		gatewaysysteminfo
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</select>
	<select id="findDevicesByGateway" resultType="map">
		SELECT
		deviceaddress,
		Sysaddress,
		Gatewayaddress
		FROM
		devices
		WHERE
		Gatewayaddress
		=#{gatewayaddress}
		and
		Sysaddress =
		#{sysaddress}
	</select>
	<select id="gePatrolRecordByOrgCount" resultType="int">
	SELECT
	count(*)
FROM
	(
		SELECT
			*
		FROM
			v_Gateway
		WHERE
			orgid = #{orgid}
		GROUP BY
			Gatewayaddress
	) b
	</select>
	<select id="getTotalFlatPic" resultType="onlineOrg">
		SELECT
		bFlatpic
		FROM
		onlineorg
		WHERE
		orgid = #{orgid}
	</select>

	<select id="selectGateway" resultMap="gatewayMap">
		
		SELECT
		Gatewayaddress,
		Manufacturer,
		Model,
		productdate,
		setupdate,
		<!-- DATE_FORMAT(productdate, '%Y/%m/%d') productdate,
		DATE_FORMAT(setupdate, '%Y/%m/%d') setupdate, -->
		ControlorManufacture,
		ControlorMode,
		memo,
		ynonline,
		onlinetime
		FROM
		v_gatewayInfo
		WHERE
		orgid =
		#{orgid}
		limit
		#{startPos},#{pageSize}
	</select>

	<select id="gatewayInfo" resultMap="gatewayMap">
		SELECT
		Gatewayaddress,
		Manufacturer,
		Model,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo,
		ynonline,
		onlinetime
		FROM
		v_gatewayInfo
		WHERE
		orgid =
		#{orgid}
		and
		Gatewayaddress=#{gatewayaddress}

	</select>
	<resultMap type="gateway" id="gatewayMap">
		<id column="Gatewayaddress" property="gatewayaddress" />
		<result column="Manufacturer" property="manufacturer" />
		<result column="Model" property="model" />
		<result column="ControlorManufacture" property="controlorManufacture" />
		<result column="ControlorMode" property="controlorMode" />
		<result column="memo" property="memo" />
		<result column="ynonline" property="ynonline" />
		<result column="onlinetime" property="onlinetime" />
		<collection property="gatewaySystemInfoList" column="Gatewayaddress"
			select="selectVgateway" />
	</resultMap>

	<select id="selectVgateway" resultType="gatewaySystemInfo">
		SELECT
		siteid,
		sitename,
		tiSysType,
		vSysdesc,
		Sysaddress
		FROM
		v_Gateway
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
	</select>
	<insert id="addSite">
		INSERT INTO site (
		siteid,
		sitename,
		buildingaddress,
		useproperty,
		DSCS,
		JZGD,
		DSJZMJ,
		NHDJ,
		JGLX,
		DXCS,
		DXJZMJ,
		SDQK,
		ZYCCW,
		RLRS,
		QLJZ,
		east,
		west,
		south,
		north,
		xx,
		yy,
		sitetypename,
		holdthings,
		holdthingsnum,
		annalTime,
		fLongitude,
		fLatitude,
		orgid
		)
		VALUES
		(#{siteid},
		#{sitename},
		#{buildingaddress},
		#{useproperty},
		#{dSCS},
		#{jZGD},
		#{dSJZMJ},
		#{nHDJ},
		#{jGLX},
		#{dXCS},
		#{dXJZMJ},
		#{sDQK},
		#{zYCCW},
		#{rLRS},
		#{qLJZ},
		#{east},
		#{west},
		#{south},
		#{north},
		#{xx},
		#{yy},
		#{sitetypename},
		#{holdthings},
		#{holdthingsnum},
		#{annalTime},
		#{fLongitude},
		#{fLatitude},
		#{orgid}
		)
	</insert>
	<update id="updateSite">
		UPDATE site
		<trim prefix="set" suffixOverrides=",">
			<if test="sitename!=null and sitename!=''"> sitename =#{sitename},</if>
			<if test="buildingaddress!=null and buildingaddress!=''"> buildingaddress =#{buildingaddress},</if>
			<if test="useproperty!=null and useproperty!=''"> useproperty=#{useproperty},</if>
			<if test="dSCS!=null and dSCS!=''"> DSCS=#{dSCS},</if>
			<if test="jZGD!=null and jZGD!=''"> JZGD=#{jZGD},</if>
			<if test="dSJZMJ!=null and dSJZMJ!=''"> DSJZMJ=#{dSJZMJ},</if>
			<if test="nHDJ!=null and nHDJ!=''"> NHDJ=#{nHDJ},</if>
			<if test="jGLX!=null and jGLX!=''"> JGLX=#{jGLX},</if>
			<if test="dXCS!=null and dXCS!=''"> DXCS=#{dXCS},</if>
			<if test="dXJZMJ!=null and dXJZMJ!=''"> DXJZMJ=#{dXJZMJ},</if>
			<if test="sDQK!=null and sDQK!=''"> SDQK=#{sDQK},</if>
			<if test="zYCCW!=null and zYCCW!=''"> ZYCCW=#{zYCCW},</if>
			<if test="rLRS!=null and rLRS!=''"> RLRS=#{rLRS},</if>
			<if test="qLJZ!=null and qLJZ!=''"> QLJZ=#{qLJZ},</if>
			<if test="east!=null and east!=''"> east=#{east},</if>
			<if test="west!=null and west!=''"> west=#{west},</if>
			<if test="south!=null and south!=''"> south=#{south},</if>
			<if test="north!=null and north!=''"> north=#{north},</if>
			<if test="sitetypename!=null and sitetypename!=''"> sitetypename=#{sitetypename},</if>
			<if test="holdthings!=null and holdthings!=''"> holdthings=#{holdthings},</if>
			<if test="holdthingsnum!=null and holdthingsnum!=''"> holdthingsnum=#{holdthingsnum},</if>
			<if test="annalTime!=null and annalTime!=''"> annalTime=#{annalTime},</if>
			<if test="fLongitude!=null and fLongitude!=''"> fLongitude=#{fLongitude},</if>
			<if test="fLatitude!=null and fLatitude!=''"> fLatitude=#{fLatitude},</if>
		</trim>
		WHERE
		siteid = #{siteid} and orgid =#{orgid}
	</update>
	<insert id="addGatewaySysInfo">
		INSERT INTO gatewaysysteminfo (
		Sysaddress,
		Gatewayaddress,
		tiSysType,
		siteid
		)
		VALUES
		(
		#{sysaddress},
		#{gatewayaddress},
		#{tiSysType},
		#{siteid}
		)
	</insert>
	<!-- <insert id="updateGateway">
		INSERT INTO gateway (
		Manufacturer,
		Model,
		Gatewayaddress,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo
		)
		VALUES
		(
		#{manufacturer} ,
		#{model} ,
		#{gatewayaddress},
		#{productdate} ,
		#{setupdate} ,
		#{controlorManufacture} ,
		#{controlorMode} ,
		#{memo}
		)
	</insert> -->
	
	<insert id="addGateway">
		INSERT INTO gateway (
		Gatewayaddress,
		Manufacturer,
		Model,
		productdate,
		setupdate,
		ControlorManufacture,
		ControlorMode,
		memo
		)
		VALUES
		(
		#{gatewayaddress},
		#{manufacturer},
		#{model},
		#{productdate},
		#{setupdate},
		#{controlorManufacture},
		#{controlorMode},
		#{memo}
		)
	</insert>
	
	<select id="findGatewayaddressExist" resultType="int">
		SELECT
		count(*)
		FROM
		gateway
		WHERE
		Gatewayaddress = #{gatewayaddress}
	</select>
	<select id="getAppearancepic" resultType="map">
		SELECT

		iphotoID,
		vPhotoname,
		dRecordDate,
		Picpath,
		ExteriorInfo,
		siteid
		FROM
		appearancepic
		WHERE
		siteid = #{siteid}
	</select>
	<update id="updateGatewaySame">
		UPDATE gateway
		<trim prefix="set" suffixOverrides=",">
			<if test="manufacturer!=null and manufacturer!=''">
				Manufacturer = #{manufacturer},
			</if>
			<if test="model!=null and model!=''">
				Model = #{model} ,
			</if>
			<if test="productdate!=null and productdate!=''">
				productdate = #{productdate} ,
			</if>
			<if test="setupdate!=null and setupdate!=''">
				setupdate =#{setupdate} ,
			</if>
			<if test="controlorManufacture!=null and controlorManufacture!=''">
				ControlorManufacture = #{controlorManufacture} ,
			</if>
			<if test="controlorMode!=null and controlorMode!=''">
				ControlorMode = #{controlorMode} ,
			</if>
			<if test="memo!=null and memo!=''">
				memo = #{memo},
			</if>
		</trim>
		WHERE
		Gatewayaddress =#{gatewayaddress}
	</update>
	<update id="updateOrgSummary">
		update  introduce
		<trim prefix="set" suffixOverrides=",">
			<if test="vIntroduceText !=null and vIntroduceText!=''">
				vIntroduceText = #{vIntroduceText},
			</if>
		</trim>
		WHERE
		orgid =#{orgid}
	</update>
	<insert id="editOrgSummary">
		insert into  
		introduce
		(orgid,vPicturePath)
		values
		(#{orgid},#{vIntroduceText} )
	</insert>

	<insert id="updateGatewaySysInfo">
		INSERT INTO
		gatewaysysteminfo
		(siteid,tiSysType,Gatewayaddress,Sysaddress)
		values
		(#{siteid},#{tiSysType},#{gatewayaddress}, #{sysaddress} )
	</insert>
<select id="getflatpicCount" resultType="int">
		SELECT
		count(*)
		FROM
		site s
		RIGHT JOIN flatpic f ON s.siteid = f.siteid
		WHERE
		s.orgid = #{orgid}
		<if test="siteid!='0'.toString() and siteid!=null">
			AND
			s.siteid =#{siteid}
		</if>
	</select>
	<select id="getflatpicListPage" resultType="flatpic">
	SELECT
	s.siteid,
	sitename,
	cFlatPic,
	floornum,
	dRecordSet,
	imFlatPic
FROM
	site s
RIGHT JOIN flatpic f ON s.siteid = f.siteid
		WHERE
		s.orgid = #{orgid}
		<if test="siteid!='0'.toString() and siteid!=null">
			AND
			s.siteid =#{siteid}
		</if>
		limit
		#{startPos},#{pageSize}

	</select>
	<select id="getOrgSummary" resultType="map">
	SELECT
		vIntroduceText vIntroduceText,
		vPicturePath vPicturePath
	FROM
		introduce
	WHERE
	orgid = #{orgid}
		

	</select>

	<delete id="deleteflatPic">
		DELETE
		FROM
		flatpic
		WHERE
		cFlatPic = #{cFlatPic}
	</delete>
	<delete id="deleteflatPicBySiteId">
		DELETE
		FROM
		flatpic
		WHERE
		siteid = #{siteid}
	</delete>
	<delete id="deleteDevices">
		DELETE
		FROM
		devices
		WHERE
		deviceaddress =
		#{deviceaddress} and
		Sysaddress = #{sysaddress} and
		Gatewayaddress =
		#{gatewayaddress}
	</delete>
	<delete id="deleteDevices1">
		DELETE
		FROM
		devices
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
		and
		Sysaddress =
		#{sysaddress}
	</delete>
	<delete id="deleteAnlogAlarmSettings">
		DELETE
		FROM
		anlogalarmsettings
		WHERE
		Gatewayaddress =
		#{gatewayaddress}
		and
		Sysaddress =
		#{sysaddress}
		and
		deviceaddress =
		#{deviceaddress}
	</delete>
	<select id="findMaxDeviceNo" resultType="string">
		SELECT
		max(DeviceNo)
		FROM
		devices
		WHERE
		cFlatPic = #{cFlatPic}
	</select>
	<select id="deviceTypeList" resultType="map">
		SELECT
		iDeviceType,
		DeviceTypeName
		FROM
		devicetype
	</select>
<!-- 	<select id="onlineAllInfo" resultMap="onlineAllInfoMap">
	
	SELECT
	orgid,
	orgcode,
	orgname,
	vAddress,
	OrganType,
	vNamelegalperson,
	otherthings,
	YnImportant,
	SuperiorOrg,
	cZip,
	vTel,
	fax,
	`E-mail` E_Mail,
	howmanypeople,
	souyouzhi,
	DATE_FORMAT(SetupDate, '%Y/%m/%d') SetupDate,
	realtymoney,
	ipersonnum,
	fAreanum,
	fBuildingarea,
	GasType,
	howmanyfireman,
	howmanyexit,
	howmanystair,
	howmanylane,
	howmanyelevator,
	lanelocation,
	vfireroomtel,
	escapefloor,
	escapebuildingarea,
	escapelocation,
	neareast,
	nearsouth,
	nearwest,
	nearnorth,
	AutoFireFacility,
	fLongitude,
	fLatitude,
	DATE_FORMAT(dRecordDate, '%Y/%m/%d') dRecordDate,
	managegrade,
	NetworkStatus,
	NetworkTime,
	ApproveState,
	ApproveMan,
	DATE_FORMAT(
		ApproveTime,
		'%Y/%m/%d %h:%s:%m'
	) ApproveTime,
	o.AreaId,
	AreaName,
	ManagerOrgID,
	bFlatpic
FROM
	onlineorg o
INNER JOIN area a ON o.AreaId = a.AreaId
	where orgid=#{orgid}		
	</select>
	<resultMap type="map" id="onlineAllInfoMap"></resultMap> -->
	
	<select id="getLabelledDevice" resultType="map">
	SELECT
		d.DeviceNo,
		d.deviceaddress,
		d.fPositionX,
		d.fPositionY,
		d.iDeviceType,
		d.Sysaddress,
		d.Gatewayaddress,
		t.DeviceTypeName
	FROM
		devices d
	INNER JOIN devicetype t ON d.iDeviceType = t.iDeviceType
	where 
	d.cFlatPic = #{cFlatPic}
	</select>

	<insert id="addDevices">
		INSERT INTO devices (
		DeviceNo,
		deviceaddress,
		Road,
		Address,
		sysaddress,
		gatewayaddress,
		vdesc,
		fPositionX,
		fPositionY,
		location,
		Manufacture,
		Model,
		ProductDate,
		expdate,
		AddTime,
		memo,
		cFlatPic,
		iDeviceType
		)
		VALUES
		(
		#{deviceNo} ,
		#{deviceaddress} ,
		#{road} ,
		#{address},
		#{sysaddress},
		#{gatewayaddress},
		#{vdesc} ,
		#{fPositionX} ,
		#{fPositionY} ,
		#{location} ,
		#{manufacture} ,
		#{model} ,
		#{productDate} ,
		#{expdate} ,
		#{addTime} ,
		#{memo} ,
		#{cFlatPic} ,
		#{iDeviceType}
		)
	</insert>
	<update id="updateDevices">
		UPDATE devices
		<trim prefix="set" suffixOverrides=",">
			<if test="deviceNo!=null and deviceNo!=''">
				DeviceNo = #{deviceNo} ,
			</if>
			<if test="road!=null and road!=''">
				Road =#{road} ,
			</if>
			<if test="address!=null and address!=''">
				Address = #{address} ,</if>
			<if test="vdesc!=null and vdesc!=''">
				vdesc = #{vdesc} ,</if>
			<if test="fPositionX!=null and fPositionX!=''">
				fPositionX =#{fPositionX} ,
			</if>
			<if test="fPositionY!=null and fPositionY!=''">
				fPositionY = #{fPositionY} ,
			</if>
			<if test="location!=null and location!=''">
				location = #{location} ,
			</if>
			<if test="manufacture!=null and manufacture!=''">
				Manufacture = #{manufacture} ,
			</if>
			<if test="model!=null and model!=''">
				Model = #{model} ,
			</if>
			<if test="productDate!=null and productDate!=''">
				ProductDate =#{productDate} ,
			</if>
			<if test="expdate!=null and expdate!=''">
				expdate = #{expdate} ,
			</if>
			<if test="addTime!=null and addTime!=''">
				AddTime = #{addTime} ,
			</if>
			<if test="memo!=null and memo!=''">
				memo =#{memo} ,
			</if>
			<if test="cFlatPic!=null and cFlatPic!=''">
				cFlatPic = #{cFlatPic} ,
			</if>
			<if test="iDeviceType!=null and iDeviceType!=''">
				iDeviceType = #{iDeviceType},
			</if>
		</trim>
		WHERE
		deviceaddress = #{deviceaddress} and
		Sysaddress = #{sysaddress}
		and
		Gatewayaddress = #{gatewayaddress}
	</update>
	<delete id="deleteDevicesBycflatPic">
		DELETE
		FROM
		devices
		WHERE
		cFlatPic = #{cFlatPic}
	</delete>
	<select id="siteDevicesCount" resultType="int">
	SELECT
		count(*)
	FROM
		site s
	INNER JOIN flatpic f ON s.siteid = f.siteid
	WHERE
		orgid= #{orgid}
		<if test="siteid!=''and siteid!=null">
			and s.siteid=#{siteid}
		</if>

	</select>
	<select id="existOrgSummary" resultType="int">
		SELECT
		count(*)
		FROM
		introduce
		WHERE
		orgid= #{orgid}
		
	</select>
	<select id="findDevicesByKey" resultType="int">
		SELECT
		count(*)
		FROM
		devices
		WHERE
		deviceaddress = #{deviceAddr} and
		Sysaddress =
		#{sysaddress}
		and
		Gatewayaddress = #{gatewayaddress}

	</select>
	<select id="siteDevices" resultType="map">
	SELECT
		s.orgid,
		s.siteid,
		s.sitename,
		f.floornum,
		f.cFlatPic,
		f.imFlatPic,
		count(DeviceNo) deviceCount
	FROM
		site s
	INNER JOIN flatpic f ON s.siteid = f.siteid
	LEFT JOIN devices d ON f.cFlatPic = d.cFlatPic
	where
		orgid= #{orgid}
		<if test="siteid!=''and siteid!=null">
			and s.siteid=#{siteid}
		</if>
	GROUP BY
		s.siteid

	</select>
	<select id="selectDevicesListCount" resultType="int">
		SELECT
		count(*)
		FROM
		devices c
		INNER JOIN flatpic f ON
		c.cFlatPic =
		f.cFlatPic
		INNER JOIN devicetype d ON c.iDeviceType =
		d.iDeviceType
		where
		c.cFlatPic = #{cFlatPic}
		<if test="iDeviceType!='0'.toString()">
			AND
			c.iDeviceType = #{iDeviceType}
		</if>
		<if test="deviceaddress!='0'.toString() ">
			AND
			c.deviceaddress like concat('%', #{deviceaddress}, '%')
		</if>
	</select>
	<select id="selectDevicesLists" resultType="map">
		SELECT
		c.deviceaddress,
		c.sysaddress Sysaddress,
		c.gatewayaddress
		Gatewayaddress,
		c.fPositionX,
		c.fPositionY,
		c.location,
		c.DeviceNo,
		c.iDeviceType,
		f.imFlatPic,
		d.DeviceTypeName
		FROM
		devices c
		INNER JOIN
		flatpic f ON
		c.cFlatPic = f.cFlatPic
		INNER JOIN devicetype d ON
		c.iDeviceType =
		d.iDeviceType
		WHERE
		c.cFlatPic =#{cFlatPic}
		<if test="iDeviceType!='0'.toString()">
			AND
			c.iDeviceType = #{iDeviceType}
		</if>
		<if test="deviceaddress!='0'.toString() ">
			AND
			c.deviceaddress like concat('%', #{deviceaddress}, '%')
		</if>
	</select>
	<select id="selectDeviceDetail" resultType="map">
	SELECT
	c.deviceaddress,
	c.Sysaddress,
	c.Gatewayaddress,
	c.vdesc,
	c.fPositionX,
	c.fPositionY,
	c.location,
	c.Manufacture,
	c.Model,
	DATE_FORMAT(c.ProductDate, '%Y/%m/%d') ProductDate,
	DATE_FORMAT(c.expdate, '%Y/%m/%d') expdate,
	DATE_FORMAT(c.AddTime, '%Y/%m/%d') AddTime,
	c.memo,
	c.DeviceNo,
	c.cFlatPic,
	c.iDeviceType,
	c.StateValue,
	DATE_FORMAT(c.StateTime, '%Y/%m/%d') StateTime,
	d.DeviceTypeName
FROM
	flatpic f
INNER JOIN devices c ON c.cFlatPic = f.cFlatPic
INNER JOIN devicetype d ON c.iDeviceType = d.iDeviceType
	WHERE
		c.Gatewayaddress = #{gatewayaddress}
	AND c.Sysaddress = #{sysaddress}
	AND c.deviceaddress = #{deviceaddress}

	</select>

	<select id="findMaxBack8" resultType="string">
		SELECT

		max(CONVERT
		(RIGHT(s.siteid, 8), SIGNED)) maxsiteid

		FROM
		site s
		WHERE
		s.orgid =
		#{orgid}
	</select>


</mapper>